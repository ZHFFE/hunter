!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.hunter=t()}(this,function(){function e(e,t,r){return e.apply(r,t)}function t(e){return e?u.parse(e):{}}var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},c=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},u={assignObject:function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e},stringify:function(e){if(window.JSON&&window.JSON.stringify)return JSON.stringify(e);var t=void 0===e?"undefined":r(e);if("object"!=t||null===e)return"string"==t&&(e='"'+e+'"'),String(e);var n,o,i=[],c=e&&e.constructor==Array,u=arguments.callee;for(n in e)e.hasOwnProperty(n)&&(o=e[n],t=void 0===o?"undefined":r(o),e.hasOwnProperty(n)&&("string"==t?o='"'+o+'"':"object"==t&&null!==o&&(o=u(o)),i.push((c?"":'"'+n+'":')+String(o))));return(c?"[":"{")+String(i)+(c?"]":"}")},parse:function(e){return e="undefined"!=e?e:{},window.JSON&&window.JSON.parse?JSON.parse(e):new Function("return "+e)()},getPlatType:function(){try{return document.createEvent("TouchEvent"),"Mobile"}catch(e){return"PC"}},getSystemInfo:function(){var e=window.screen;return{userAgent:window.navigator.userAgent,currentUrl:window.location.href,timestamp:+new Date+Math.random(),projectType:u.getPlatType(),title:document.title,screenSize:e.width+"x"+e.height,referer:document.referrer?document.referrer.toLowerCase():"",host:window.location.protocol+"//"+window.location.hostname,env:window.location.hostname.split(".")[0]}},typeDecide:function(e,t){return Object.prototype.toString.call(e)==="[object "+t+"]"},toArray:function(e){return Array.prototype.slice.call(e)},serializeObj:function(e){var t="";return Object.keys(e).forEach(function(r){u.typeDecide(e[r],"Object")?t+=u.stringify(e[r]):t+=e[r]}),encodeURIComponent(t)},noop:function(){}},a=function(){function e(t){n(this,e),this.config={localKey:"hunter",url:"http://lxh.error.brandwisdom.cn/error.gif?",delay:3e3,repeat:5},this.config=u.assignObject(this.config,t)}return o(e,[{key:"get",value:function(e){return this.config[e]}},{key:"set",value:function(e,t){return this.config[e]=t,this.config[e]}}]),e}(),s={getKey:function(e){var t=function(t){return e[t]};return["msg","colNum","rowNum"].filter(t).map(t).join("@")},getInfo:function(e,t){var r=s.getItem(e);if(t){r[s.getKey(t.msg)]={value:t}}return u.stringify(r)},getItem:function(e){return t(localStorage.getItem(e))},setItem:function(){for(var t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];return localStorage.setItem(r[0],e(s.getInfo,r,s))},clear:function(e){return e?localStorage.removeItem(e):localStorage.clear()}};return function(e){function t(e){n(this,t);var r=c(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.rewriteError(),r}return i(t,e),o(t,[{key:"rewriteError",value:function(){var e=this,t=arguments,r=window.onerror||u.noop;window.onerror=function(n,o,i,c,a){c=c||window.event&&window.event.errorCharacter||0;var s=n;if(a&&a.stack)s=e.handleErrorStack(a);else{for(var f=[],l=t.callee.caller,p=3;l&&--p>0&&(f.push(l.toString()),l!==l.caller);)l=l.caller;f.length>0&&(s+="@"+f.join(","))}u.typeDecide(s,"Event")&&(s+=s.type?"--"+s.type+"--"+(s.target?s.target.tagName+"::"+s.target.src:""):""),s&&e.error({msg:s,rowNum:i,colNum:c,targetUrl:o}),r.call(null,n,o,i,c,a)}}},{key:"handleErrorStack",value:function(e){var t=e.stack,r=e.toString();return r?-1===t.indexOf(r)&&(t+="@"+r):t="",t}}]),t}(function(e){return function(e){function t(e){n(this,t);var r=c(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.errorQueue=[],r.repeatList={},["warn","error"].forEach(function(e,t){r[e]=function(n){return r.handle(n,e,t)}}),r}return i(t,e),o(t,[{key:"request",value:function(e,t){e=e.slice(0,8180);var r=new window.Image;r.onload=t,r.src=e}},{key:"report",value:function(e){var t=this,r=this.config.url,n=this.config.localKey,o=this.getItem(n);return r+=u.serializeObj(o),this.request(r,function(){e&&e.call(t)}),r}},{key:"repeat",value:function(e){var t=e.rowNum||"",r=e.colNum||"",n=e.msg+t+r;return this.repeatList[n]=this.repeatList[n]?this.repeatList[n]+1:1,this.repeatList[n]>this.config.repeat}},{key:"catchError",value:function(e){return console.log(e,"before set"),this.setItem(e),!this.repeat(e)}},{key:"send",value:function(e){var t=this,r=e||u.noop,n=this.config.delay;setTimeout(function(){t.report(r)},n)}},{key:"handle",value:function(e,t,r){var n=this,o=this.config.localKey,i={msg:e.message+e.stack,cause:t,level:r};return i=u.assignObject(u.getSystemInfo(),i),console.log(i,"errorMsg"),this.catchError(i)&&this.send(function(){console.log("success"),n.clear(o)}),i}}]),t}(e)}(function(e){return function(e){function t(e){n(this,t);var r=c(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.setItem(),r}return i(t,e),o(t,[{key:"getItem",value:function(e){return s.getItem(e)}},{key:"setItem",value:function(e){this.config;return s.setItem(this.config.localKey,e),u.stringify(e)}},{key:"clear",value:function(e){s.clear(e)}}]),t}(e)}(a)))});
