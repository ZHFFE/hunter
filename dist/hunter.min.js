!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.hunter=e()}(this,function(){function t(t,e,r){return t.apply(r,e)}function e(t){return t?u.parse(t):{}}var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},o=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},c=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},u={assignObject:function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t},stringify:function(t){if(window.JSON&&window.JSON.stringify)return JSON.stringify(t);var e=void 0===t?"undefined":r(t);if("object"!=e||null===t)return"string"==e&&(t='"'+t+'"'),String(t);var n,o,i=[],c=t&&t.constructor==Array,u=arguments.callee;for(n in t)t.hasOwnProperty(n)&&(o=t[n],e=void 0===o?"undefined":r(o),t.hasOwnProperty(n)&&("string"==e?o='"'+o+'"':"object"==e&&null!==o&&(o=u(o)),i.push((c?"":'"'+n+'":')+String(o))));return(c?"[":"{")+String(i)+(c?"]":"}")},parse:function(t){return t="undefined"!=t?t:{},window.JSON&&window.JSON.parse?JSON.parse(t):new Function("return "+t)()},getPlatType:function(){try{return document.createEvent("TouchEvent"),"Mobile"}catch(t){return"PC"}},getSystemInfo:function(){var t=window.screen;return{userAgent:window.navigator.userAgent,currentUrl:window.location.href,timestamp:+new Date+Math.random(),projectType:u.getPlatType(),title:document.title,screenSize:t.width+"x"+t.height,referer:document.referrer?document.referrer.toLowerCase():"",host:window.location.protocol+"//"+window.location.hostname,env:window.location.hostname.split(".")[0]}},typeDecide:function(t,e){return Object.prototype.toString.call(t)==="[object "+e+"]"},toArray:function(t){return Array.prototype.slice.call(t)},serializeObj:function(t){var e="";return Object.keys(t).forEach(function(r){u.typeDecide(t[r],"Object")?e+=u.stringify(t[r]):e+=t[r]}),encodeURIComponent(e)},noop:function(){}},a=function(){function t(e){n(this,t),this.config={localKey:"hunter",url:"http://lxh.error.brandwisdom.cn/error.gif?",delay:3e3,repeat:5},this.config=u.assignObject(this.config,e)}return o(t,[{key:"get",value:function(t){return this.config[t]}},{key:"set",value:function(t,e){return this.config[t]=e,this.config[t]}}]),t}(),f={getKey:function(t){var e=function(e){return t[e]};return["msg","colNum","rowNum"].filter(e).map(e).join("@")},getInfo:function(t,e){var r=f.getItem(t);if(e){r[f.getKey(e.msg)]={value:e}}return u.stringify(r)},getItem:function(t){return e(localStorage.getItem(t))},setItem:function(){for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];return localStorage.setItem(r[0],t(f.getInfo,r,f))},clear:function(t){return t?localStorage.removeItem(t):localStorage.clear()}};return function(t){function e(t){n(this,e);var r=c(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return r.rewriteError(),r}return i(e,t),o(e,[{key:"rewriteError",value:function(){var t=this,e=arguments,r=window.onerror||u.noop;window.onerror=function(n,o,i,c,a){c=c||window.event&&window.event.errorCharacter||0;var f=n;if(a&&a.stack)f=t.handleErrorStack(a);else{for(var l=[],s=e.callee.caller,p=3;s&&--p>0&&(l.push(s.toString()),s!==s.caller);)s=s.caller;l.length>0&&(f+="@"+l.join(","))}u.typeDecide(f,"Event")&&(f+=f.type?"--"+f.type+"--"+(f.target?f.target.tagName+"::"+f.target.src:""):""),f&&t.error({msg:f,rowNum:i,colNum:c,targetUrl:o}),r.call(null,n,o,i,c,a)}}},{key:"handleErrorStack",value:function(t){var e=t.stack,r=t.toString();return r?-1===e.indexOf(r)&&(e+="@"+r):e="",e}}]),e}(function(t){return function(t){function e(t){n(this,e);var r=c(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return r.errorQueue=[],r.repeatList={},["warn","error"].forEach(function(t,e){r[t]=function(n){return r.handle(n,t,e)}}),r}return i(e,t),o(e,[{key:"request",value:function(t,e){var r=new window.Image;r.onload=e,r.src=t}},{key:"report",value:function(t){var e=this,r=this.config.url,n=this.config.localKey,o=this.getItem(n);return r+=u.serializeObj(o),this.request(r,function(){t&&t.call(e)}),r}},{key:"repeat",value:function(t){var e=t.rowNum||"",r=t.colNum||"",n=t.msg+e+r;return this.repeatList[n]=this.repeatList[n]?this.repeatList[n]+1:1,this.repeatList[n]>this.config.repeat}},{key:"catchError",value:function(t){return this.setItem(t),!this.repeat(t)}},{key:"send",value:function(t){var e=this,r=t||u.noop,n=this.config.delay;setTimeout(function(){e.report(r)},n)}},{key:"handle",value:function(t,e,r){var n=this,o=this.config.localKey,i={msg:t,level:r};return i=u.assignObject(u.getSystemInfo(),i),this.catchError(i)&&this.send(function(){n.clear(o)}),i}}]),e}(t)}(function(t){return function(t){function e(t){n(this,e);var r=c(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return r.setItem(),r}return i(e,t),o(e,[{key:"getItem",value:function(t){return f.getItem(t)}},{key:"setItem",value:function(t){this.config;return f.setItem(this.config.localKey,t),u.stringify(t)}},{key:"clear",value:function(t){f.clear(t)}}]),e}(t)}(a)))});
